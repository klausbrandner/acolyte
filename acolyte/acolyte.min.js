/**

	5-designs - company
	Acolyte
	created with love in Austria

	Version: 0.1.0
	Last changed: 04-01-2016
	Website: http://www.acolyte.5-designs.com
	Github: https://github.com/5-designs/acolyte

*/

function CreateRequest(a){for(var b=10,c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOP1234567890",d="",e=0;b>e;e++){var f=Math.floor(Math.random()*c.length);d+=c.charAt(f)}document.cookie="aco-token="+d+";path=/",a(d)}var acolyte={pathToAcolyte:"acolyte/",pathToServer:"acolyte/server/",tmpImage:"src/images/black.png",tmpText:"...",newText:"Hi, I'm a new text.",updateRate:1e3};!function(){angular.module("Acolyte",["ngSanitize"]).directive("acoRoot",function(){return{restrict:"E",controller:"AcoRootController",controllerAs:"rootCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-root.html"}}).factory("AcoPageContentService",["$rootScope","$http",function(a,b){function c(a){console.log(a),d.texts=a.textContent,d.images=a.fileContent,d.broadcastPageContent()}var d={};return d.texts={},d.images={},d.edit=!1,d.setEdit=function(a){"undefined"!=typeof a?d.edit=a:d.edit=!d.edit,d.broadcastEditMode()},d.getEditMode=function(){return d.edit},d.fetchContent=function(){CreateRequest(function(a){b.get(acolyte.pathToServer+"content/get").success(function(a){c(a)}).error(function(a){console.log(a)})})},d.setContent=function(a){c(a)},d.getText=function(a,b){for(var c=!1,e=0;e<d.texts.length;e++){var f=d.texts[e];f.category==a&&f.element==b&&(c=f.text)}return c},d.setText=function(a,b,c){for(var e=!1,f=0;f<d.texts.length;f++){var g=d.texts[f];g.category==a&&g.element==b&&(d.texts[f].text=c,e=!0)}if(!e){var g={category:a,element:b,text:c};d.texts.push(g)}d.broadcastPageContent()},d.getImage=function(a,b){for(var c=!1,e=0;e<d.images.length;e++){var f=d.images[e];f.category==a&&f.element==b&&(c=f.url)}return c},d.setImage=function(a,b,c){for(var e=!1,f=0;f<d.images.length;f++){var g=d.images[f];g.category==a&&g.element==b&&(d.images[f].url=c,e=!0)}if(!e){var g={category:a,element:b,url:c};d.images.push(g)}d.broadcastPageContent()},d.broadcastPageContent=function(){a.$broadcast("AcoPageContentChanged")},d.broadcastEditMode=function(){a.$broadcast("AcoEditModeChanged")},d}]).controller("AcoRootController",["$scope","$http","$timeout","AcoPageContentService","AcoLoginService",function(a,b,c,d,e){function f(){c(function(){e.checkLoginState()})}f(),a.$on("AcoLoginStateChanged",function(){d.fetchContent()})}])}(),$(document).ready(function(){}),function(){angular.module("Acolyte").controller("AcoAdminController",["$scope","$http","AcoPageContentService","AcoLoginService","AcoMessageBoxService","AcoNotificationService",function(a,b,c,d,e,f){function g(){$("aco-admin").draggable({handle:"#aco-admin-drag",containment:"document",stop:function(){var a=$(this).offset().top,b=$(window).scrollTop(),c=screen.availHeight;b>a&&$(this).css({top:"0px"});var d=b+c;a>d&&$(this).css({bottom:"0px"})}})}function h(){CreateRequest(function(a){b.put(acolyte.pathToServer+"content/save/all").success(function(a){f.push("success","Page published","Yeah, your page content is now visible for everyone.")}).error(function(a){console.log(a)})})}function i(){CreateRequest(function(a){b.put(acolyte.pathToServer+"content/save/lan").success(function(a){f.push("success","Page published","Yeah, your page content is now visible for everyone.")}).error(function(a){console.log(a)})})}var j=this;j.edit=!1,j.showPanel=!1,j.dragImg=acolyte.pathToAcolyte+"src/dragW.png",g(),j.setEditMode=function(){c.setEdit()},j.selectLan=function(){var a=$("#aco-admin-panel").find("#aco-admin-lan-box"),b=$("#aco-admin-panel").find("#aco-admin-table");if("none"==a.css("display")){b.find("#aco-admin-lan").addClass("active");var c=a.outerHeight(),d=b.offset().top-$(window).scrollTop();c>d?(a.addClass("aco-lan-top"),a.removeClass("aco-lan-bottom")):(a.addClass("aco-lan-bottom"),a.removeClass("aco-lan-top"))}else b.find("#aco-admin-lan").removeClass("active");a.slideToggle(200)},j.publish=function(){e.pushMessage({title:"Publish page",message:"Do you want to publish all languages or just the current one?",buttons:[{title:"Publish all",callback:h},{title:"Publish current",callback:i}]})},a.$on("AcoEditModeChanged",function(){j.edit=c.getEditMode()}),a.$on("AcoLoginStateChanged",function(){j.showPanel=d.getLoginState(),j.showPanel||c.setEdit(!1)})}])}(),function(){angular.module("Acolyte").directive("acoAdmin",function(){return{restrict:"E",controller:"AcoAdminController",controllerAs:"acoAdminCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-admin.html"}})}(),function(){angular.module("Acolyte").controller("AcoImageController",["$scope","AcoPageContentService","AcoLoginService","AcoImageUploadService",function(a,b,c,d){var e=this;e.editable=!1,e.src=acolyte.tmpImage,e.edit=function(b){c.getLoginState()&&e.editable&&(b.preventDefault(),b.stopPropagation(),$("#aco-img-upload-box").find("#aco-img-upload-input").trigger("click"),d.setTmpImage({category:a.category,element:a.element}))},a.$on("AcoPageContentChanged",function(){var c=b.getImage(a.category,a.element);c||(c=acolyte.tmpImage),e.src=c}),a.$on("AcoEditModeChanged",function(){e.editable=b.getEditMode()})}]).controller("AcoBackgroundController",["$scope","AcoPageContentService","AcoLoginService","AcoImageUploadService",function(a,b,c,d){var e=this;e.editable=!1,e.edit=function(b){c.getLoginState()&&($("#aco-img-upload-box").find("#aco-img-upload-input").trigger("click"),d.setTmpImage({category:a.category,element:a.element}))},a.$on("AcoEditModeChanged",function(){e.editable=b.getEditMode()}),a.$on("AcoLoginStateChanged",function(){c.getLoginState()||(e.editable=!1)})}]).controller("AcoImageUploadController",["$scope","AcoNotificationService","AcoImageUploadService","AcoPageContentService",function(a,b,c,d){function e(){$(document).on("change","#aco-img-upload-box #aco-img-upload-input",function(){var c=$(this)[0].files;if(c.length>0){h.status="Preparing upload...",h.percentage="please wait",a.$apply(),$("#aco-img-upload-box").css({display:"table",opacity:"1"});var d=$(this).val().split(".").pop();console.log(d),"jpg"==d&&(d="jpeg"),console.log(d),"jpeg"==d||"png"==d||"gif"==d||"bmp"==d?f(c[0],g,"image/"+d):b.push("error","Invalid file","We are sorry, but this file-type is not supported.")}})}function f(a,b,c){var d=new Image,e=new FileReader;e.onload=function(a){d.src=a.target.result},e.readAsDataURL(a),d.onload=function(){var a,e=document.createElement("canvas"),f=e.getContext("2d");e.height=d.height,e.width=d.width,f.drawImage(d,0,0),a=e.toDataURL(c),b(a),e=null}}function g(c){h.status="Uploading image...",a.$apply();var e=acolyte.pathToServer+"content/file/edit/"+h.tmpImage.category+"/"+h.tmpImage.element,f=JSON.stringify({file:c});$.ajax({url:e,data:f,type:"PUT",contentType:"application/json",xhr:function(){var b=new window.XMLHttpRequest;return b.upload.addEventListener("progress",function(b){if(b.lengthComputable){var c=b.loaded/b.total;$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:100*c+"%"}),h.percentage=Math.round(100*c)+"%",a.$apply()}},!1),b.addEventListener("progress",function(b){if(b.lengthComputable){var c=b.loaded/b.total;$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:100*c+"%"}),h.percentage=Math.round(100*c)+"%",a.$apply()}},!1),b},success:function(c,e,f){var c=JSON.parse(c);console.log(c),200==f.status?($("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:"0%"}),$("#aco-img-upload-box").animate({opacity:"0"},400,function(){$("#aco-img-upload-box").css({display:"none"})}),d.setImage(h.tmpImage.category,h.tmpImage.element,c.fileContent.url),b.push("success","Image uploaded","Image has been successfully uploaded.")):b.push("error","Unknown error","Sorry, an unknown error occured while processing your request!"),a.$apply()},error:function(c,d,e){console.log(c),$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:"0%"}),$("#aco-img-upload-box").animate({opacity:"0"},400,function(){$("#aco-img-upload-box").css({display:"none"})}),b.push("error","Unknown error","Sorry, an unknown error occured while processing your request!"),a.$apply()}})}var h=this;h.status="Preparing upload...",h.percentage="please wait",h.tmpImage={},e(),a.$on("AcoNewUploadImage",function(){h.tmpImage=c.getTmpImage()})}])}(),function(){angular.module("Acolyte").directive("acoImg",function(){return{restrict:"AC",controller:"AcoImageController",controllerAs:"acoImgCtrl",replace:!0,scope:{category:"@",element:"@"},templateUrl:acolyte.pathToAcolyte+"templates/aco-image.html"}}).directive("acoBackground",["$compile","AcoPageContentService",function(a,b){return{restrict:"EC",controller:"AcoBackgroundController",controllerAs:"acoImgCtrl",scope:{category:"@",element:"@"},link:function(c,d,e){var f=acolyte.tmpImage,g=d.css("background-size"),h=d.css("background-position"),i=d.css("background-attachment"),j=d.css("background-repeat"),k="background:url("+f+");";k+="background-size:"+g+";",k+="background-position:"+h+";",k+="background-attachment:"+i+";",k+="background-repeat:"+j+";",e.$set("style",k),c.$on("AcoPageContentChanged",function(){var f=e.category,g=e.element,h=b.getImage(f,g);h||(h=acolyte.tmpImage);var i=d.css("background-size"),j=d.css("background-position"),k=d.css("background-attachment"),l=d.css("background-repeat"),m="background:url("+h+");";m+="background-size:"+i+";",m+="background-position:"+j+";",m+="background-attachment:"+k+";",m+="background-repeat:"+l+";",e.$set("style",m),d.find("aco-update-img-btn").remove(),d.append(a('<aco-update-img-btn ng-show="acoImgCtrl.editable" ng-click="acoImgCtrl.edit()">edit</div>')(c))})}}}]).directive("acoImgUpload",function(){return{restrict:"E",controller:"AcoImageUploadController",controllerAs:"acoImgUploadCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-img-upload.html"}})}(),function(){angular.module("Acolyte").factory("AcoImageUploadService",["$rootScope",function(a){var b=this;return b.tmpImage={},b.setTmpImage=function(a){b.tmpImage=a,b.broadcastNewTmpImage()},b.getTmpImage=function(){return b.tmpImage},b.broadcastNewTmpImage=function(){a.$broadcast("AcoNewUploadImage")},b}])}(),function(){angular.module("Acolyte").controller("AcoLanguageController",["$scope","$http","AcoLanguageService","AcoMessageBoxService","AcoNotificationService",function(a,b,c,d,e){function f(){CreateRequest(function(a){b.get(acolyte.pathToServer+"language/get").success(function(a){c.initLanguages(a.lan,a.language),c.initAvailLanguages(a.languages)}).error(function(a){console.log(a)})})}function g(a){c.deleteLanguage(a)}function h(a){c.deleteAndTexts(a)}var i=this;i.lan="en",i.languages=[],i.newLanKeyword="",i.searchResults=[],f(),i.setLan=function(a){c.setLan(a)},i.setToggle=function(a){console.log(a),c.setToggle(a)},i.deleteLanguage=function(a){1!=a.preset?d.pushMessage({title:"Delete Language",message:"Do you want to keep the texts in the database or delete them permanently?",buttons:[{title:"Delete texts",callback:function(){g(a)}},{title:"Keep texts",callback:function(){h(a)}}]}):e.push("error","Can not be deleted","Sorry, but this language is set as default language and can not be deleted.")},i.searchLan=function(){i.searchResults=c.searchAvailLans(i.newLanKeyword)},i.addLanguage=function(a){i.newLanKeyword="",i.searchResults=[],c.addLanguage(a)},a.$on("AcoLanguagesChanged",function(){i.lan=c.getLan(),i.languages=c.getLanguages()})}]).controller("AcolyteLanguageController",["$scope","AcoLanguageService",function(a,b){var c=this;c.active="en",c.languages=[{lan:"en",language:"English"},{lan:"de",language:"Deutsch"}],c.select=function(a){b.setLan(a.lan)},a.$on("AcoLanguagesChanged",function(){})}])}(),function(){angular.module("Acolyte").factory("AcoLanguageService",["$rootScope","$http","AcoPageContentService",function(a,b,c){var d=this;return d.lan="en",d.languages=[{lan:"en",language:"English",toggle:1}],d.availableLanguages=[],d.initLanguages=function(a,b){d.lan=a,d.languages=b,d.broadcastLanguagesChanged()},d.initAvailLanguages=function(a){d.availableLanguages=a},d.getLan=function(){return d.lan},d.setLan=function(a){CreateRequest(function(e){b.put(acolyte.pathToServer+"language/set/"+a).success(function(a){c.setContent(a),d.lan=a.lan,d.broadcastLanguagesChanged()}).error(function(a){console.log(a)})})},d.getLanguages=function(){return d.languages},d.searchAvailLans=function(a){var b=[];if(""!=a&&null!=a&&a.length>1)for(var c in d.availableLanguages){var e=d.availableLanguages[c],f=e.language.toLowerCase();(e.lan==a.toLowerCase()||f.indexOf(a.toLowerCase())>=0)&&b.push(d.availableLanguages[c])}return b},d.setToggle=function(a){CreateRequest(function(c){var e=1;1==a.toggle&&(e=0);var f={toggle:a.toggle,token:c};b.put(acolyte.pathToServer+"language/set/toggle/"+a.lan,f).success(function(b){console.log(b);for(var c in d.languages)d.languages[c].lan==a.lan&&(d.languages[c].toggle=e)}).error(function(a){console.log(a)})})},d.deleteLanguage=function(a){CreateRequest(function(c){b["delete"](acolyte.pathToServer+"language/remove/lan/"+a.lan).success(function(a){console.log(a),d.languages=a.language,d.broadcastLanguagesChanged()}).error(function(a){console.log(a)})})},d.deleteAndText=function(a){CreateRequest(function(c){b["delete"](acolyte.pathToServer+"language/remove/all/"+a.lan).success(function(a){console.log(a),d.languages=a.language,d.broadcastLanguagesChanged()}).error(function(a){console.log(a)})})},d.addLanguage=function(a){CreateRequest(function(c){var e={lan:a.lan,language:a.language,token:c};b.post(acolyte.pathToServer+"language/add",e).success(function(a){console.log(a),d.languages=a.language}).error(function(a){console.log(a)})})},d.broadcastLanguagesChanged=function(){a.$broadcast("AcoLanguagesChanged")},d}])}(),function(){angular.module("Acolyte").controller("AcoLoginButtonController",["$scope","AcoLoginService",function(a,b){var c=this;c.loggedIn=!1,c.openLoginPanel=function(){c.loggedIn?b.logout():$("aco-login-box").fadeIn()},a.$on("AcoLoginStateChanged",function(){c.loggedIn=b.getLoginState()})}]).controller("AcoLoginBoxController",["$scope","AcoLoginService",function(a,b){var c=this;c.loginData={},c.login=function(){b.login(c.loginData.username,c.loginData.password)},c.close=function(){$("aco-login-box").fadeOut()},a.$on("AcoLoginStateChanged",function(){$("aco-login-box").fadeOut(),c.loginData={}})}])}(),function(){angular.module("Acolyte").directive("acoLogin",[function(){return{controller:"AcoLoginButtonController",controllerAs:"acoLoginBtnCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-login-btn.html"}}]).directive("acoLoginBox",[function(){return{controller:"AcoLoginBoxController",controllerAs:"acoLoginBoxCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-login-box.html"}}])}(),function(){angular.module("Acolyte").factory("AcoLoginService",["$rootScope","$http","AcoNotificationService",function(a,b,c){var d={};return d.loggedIn=!1,d.getLoginState=function(){return d.loggedIn},d.checkLoginState=function(){CreateRequest(function(a){b.get(acolyte.pathToServer+"user/view").success(function(a){null!=a.user&&(d.loggedIn=!0),d.broadcastLoginStatus()}).error(function(a){console.log(a),d.broadcastLoginStatus()})})},d.login=function(a,e){CreateRequest(function(f){var g={username:a,password:e,token:f};b.post(acolyte.pathToServer+"user/login",g).success(function(a){console.log("logged in"),d.loggedIn=!0,c.push("success","Logged in","You where successfully logged in."),d.broadcastLoginStatus()}).error(function(a){console.log(a)})})},d.logout=function(){CreateRequest(function(a){b.put(acolyte.pathToServer+"user/logout").success(function(a){d.loggedIn=!1,c.push("success","Logged out","You where successfully logged out."),d.broadcastLoginStatus()}).error(function(a){console.log(a)})})},d.broadcastLoginStatus=function(){a.$broadcast("AcoLoginStateChanged")},d}])}(),function(){angular.module("Acolyte").controller("AcoMessageBoxController",["$scope","AcoMessageBoxService",function(a,b){function c(){$("aco-message-box").hide("fade",300,function(){d.title="",d.message="",d.buttons=[]})}var d=this;d.title="",d.message="",d.buttons=[],d.doCallback=function(a){a(),c()},d.cancel=function(){c()},a.$on("AcoMessageBoxDataChanged",function(){var a=b.getMessageData();d.title=a.title,d.message=a.message,d.buttons=a.buttons,$("aco-message-box").fadeIn(300)})}])}(),function(){angular.module("Acolyte").directive("acoMessageBox",function(){return{restrict:"E",controller:"AcoMessageBoxController",controllerAs:"acoMBCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-message-box.html"}})}(),function(){angular.module("Acolyte").factory("AcoMessageBoxService",["$rootScope",function(a){var b=this;return b.messageData={},b.getMessageData=function(){return b.messageData},b.pushMessage=function(a){b.messageData=a,b.broadcastMessageDataChanged()},b.broadcastMessageDataChanged=function(){a.$broadcast("AcoMessageBoxDataChanged")},b}])}(),function(){angular.module("Acolyte").controller("AcoNotificationController",["$scope","$timeout","AcoNotificationService",function(a,b,c){var d=this;d.notification={},d.timer=null,a.$on("AcoPushNotification",function(){null!=d.timer&&b.cancel(d.timer),$("aco-notification-box").hide("slide",200,function(){d.notification=c.getNotification(),$("aco-notification-box").show("slide",200,function(){d.timer=b(function(){$("aco-notification-box").hide("slide",200)},5e3)})})})}])}(),function(){angular.module("Acolyte").directive("acoNotificationBox",function(){return{restrict:"E",controller:"AcoNotificationController",controllerAs:"acoNotifyCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-notification-box.html"}})}(),function(){angular.module("Acolyte").factory("AcoNotificationService",["$rootScope",function(a){var b=this;return b.notification={type:"",title:"",message:""},b.push=function(a,c,d){b.notification.type=a,b.notification.title=c,b.notification.message=d,b.broadcastNotification()},b.getNotification=function(){return b.notification},b.broadcastNotification=function(){a.$broadcast("AcoPushNotification")},b}])}(),function(){angular.module("Acolyte").controller("AcoTextController",["$sce","$scope","$interval","$http","AcoPageContentService","AcoLoginService",function(a,b,c,d,e,f){function g(){var a=e.getText(b.category,b.element);null==i.timer&&(a||(a=acolyte.newText),i.text=a)}function h(){f.getLoginState()&&CreateRequest(function(a){var c=acolyte.pathToServer+"content/text/edit/"+b.category+"/"+b.element,f={text:i.text,token:a};d.put(c,f).success(function(a){e.setText(b.category,b.element,a.textContent.text)}).error(function(a){console.log(a)})})}var i=this;i.editable=!1,i.timer=null,i.text=acolyte.tmpText,g(),i.edit=function(a){f.getLoginState()&&i.editable&&(a.preventDefault(),a.stopPropagation(),c.cancel(i.timer),i.timer=c(function(){h()},acolyte.updateRate))},i.update=function(){f.getLoginState()&&(c.cancel(i.timer),i.timer=null,h())},b.$on("AcoPageContentChanged",function(){var a=e.getText(b.category,b.element);null==i.timer&&(a||(a=acolyte.newText),i.text=a)}),b.$on("AcoEditModeChanged",function(){i.editable=e.getEditMode()})}])}(),function(){angular.module("Acolyte").directive("acoText",function(){return{controller:"AcoTextController",controllerAs:"acoTxtCtrl",scope:{category:"@",element:"@"},templateUrl:acolyte.pathToAcolyte+"templates/aco-text.html"}}).directive("acoTextContenteditable",["$sce",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){function f(){var a=c.html();d.stripBr&&"<br>"==a&&(a=""),e.$setViewValue(a)}e&&(e.$render=function(){c.html(a.trustAsHtml(e.$viewValue)),c.html(e.$viewValue)},c.on("blur keyup change",function(){b.$evalAsync(f)}))}}}])}();