/**

	5-designs - company
	Acolyte
	created with love in Austria

	Version: 0.1.0
	Last changed: 26-11-2015
	Website: http://www.acolyte.5-designs.com
	Github: https://github.com/5-designs/acolyte

*/

function CreateRequest(a){for(var b=10,c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOP1234567890",d="",e=0;b>e;e++){var f=Math.floor(Math.random()*c.length);d+=c.charAt(f)}document.cookie="aco-key="+d+";path=/",a(d)}var acolyte={pathToAcolyte:"acolyte/",pathToServer:"acolyte/server/",tmpImage:"src/images/black.png",tmpText:"...",newText:"Hi, I'm a new text.",updateRate:1e3};!function(){angular.module("Acolyte",["ngSanitize"]).directive("acoRoot",function(){return{restrict:"E",controller:"AcoRootController",controllerAs:"rootCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-root.html"}}).factory("AcoPageContentService",["$rootScope","$http",function(a,b){var c={};return c.texts={},c.images={},c.edit=!1,c.setEdit=function(a){"undefined"!=typeof a?c.edit=a:c.edit=!c.edit,c.broadcastEditMode()},c.getEditMode=function(){return c.edit},c.fetchContent=function(){CreateRequest(function(a){b.get(acolyte.pathToServer+"content/get").success(function(a){console.log(a),c.texts=a.textContent,c.images=a.fileContent,c.broadcastPageContent()}).error(function(a){console.log(a)})})},c.getText=function(a,b){for(var d=!1,e=0;e<c.texts.length;e++){var f=c.texts[e];f.category==a&&f.element==b&&(d=f.text)}return d},c.setText=function(a,b,d){for(var e=!1,f=0;f<c.texts.length;f++){var g=c.texts[f];g.category==a&&g.element==b&&(c.texts[f].text=d,e=!0)}if(!e){var g={category:a,element:b,text:d};c.texts.push(g)}c.broadcastPageContent()},c.getImage=function(a,b){for(var d=!1,e=0;e<c.images.length;e++){var f=c.images[e];f.category==a&&f.element==b&&(d=f.url)}return d},c.setImage=function(a,b,d){for(var e=!1,f=0;f<c.images.length;f++){var g=c.images[f];g.category==a&&g.element==b&&(c.images[f].url=d,e=!0)}if(!e){var g={category:a,element:b,url:d};c.images.push(g)}c.broadcastPageContent()},c.broadcastPageContent=function(){a.$broadcast("AcoPageContentChanged")},c.broadcastEditMode=function(){a.$broadcast("AcoEditModeChanged")},c}]).controller("AcoRootController",["$scope","$http","$timeout","AcoPageContentService","AcoLoginService",function(a,b,c,d,e){function f(){c(function(){e.checkLoginState()})}f(),a.$on("AcoLoginStateChanged",function(){d.fetchContent()})}])}(),$(document).ready(function(){$("#clickEvent").click(function(){alert("this is a jQuery click event")})}),function(){angular.module("Acolyte").controller("AcoAdminController",["$scope","AcoPageContentService","AcoLoginService",function(a,b,c){function d(){$("aco-admin").draggable({handle:"#aco-admin-drag",containment:"document",stop:function(){var a=$(this).offset().top,b=$(window).scrollTop(),c=screen.availHeight;b>a&&$(this).css({top:"0px"});var d=b+c;a>d&&$(this).css({bottom:"0px"})}})}var e=this;e.edit=!1,e.showPanel=!1,e.dragImg=acolyte.pathToAcolyte+"src/dragW.png",d(),e.setEditMode=function(){b.setEdit()},e.selectLan=function(){var a=$("#aco-admin-panel").find("#aco-admin-lan-box"),b=$("#aco-admin-panel").find("#aco-admin-table"),c=a.outerHeight(),d=b.offset().top-$(window).scrollTop();c>d?(a.addClass("aco-lan-top"),a.removeClass("aco-lan-bottom")):(a.addClass("aco-lan-bottom"),a.removeClass("aco-lan-top")),a.slideToggle(200)},a.$on("AcoEditModeChanged",function(){e.edit=b.getEditMode()}),a.$on("AcoLoginStateChanged",function(){e.showPanel=c.getLoginState(),e.showPanel||b.setEdit(!1)})}])}(),function(){angular.module("Acolyte").directive("acoAdmin",function(){return{restrict:"E",controller:"AcoAdminController",controllerAs:"acoAdminCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-admin.html"}})}(),function(){angular.module("Acolyte").controller("AcoImageController",["$scope","AcoPageContentService","AcoLoginService","AcoImageUploadService",function(a,b,c,d){var e=this;e.editable=!1,e.src=acolyte.tmpImage,e.edit=function(b){c.getLoginState()&&e.editable&&(b.preventDefault(),b.stopPropagation(),$("#aco-img-upload-box").find("#aco-img-upload-input").trigger("click"),d.setTmpImage({category:a.category,element:a.element}))},a.$on("AcoPageContentChanged",function(){var c=b.getImage(a.category,a.element);c||(c=acolyte.tmpImage),e.src=c}),a.$on("AcoEditModeChanged",function(){e.editable=b.getEditMode()})}]).controller("AcoBackgroundController",["$scope","AcoPageContentService","AcoLoginService","AcoImageUploadService",function(a,b,c,d){var e=this;e.editable=!1,e.edit=function(b){c.getLoginState()&&($("#aco-img-upload-box").find("#aco-img-upload-input").trigger("click"),d.setTmpImage({category:a.category,element:a.element}))},a.$on("AcoEditModeChanged",function(){e.editable=b.getEditMode()}),a.$on("AcoLoginStateChanged",function(){c.getLoginState()||(e.editable=!1)})}]).controller("AcoImageUploadController",["$scope","AcoNotificationService","AcoImageUploadService","AcoPageContentService",function(a,b,c,d){function e(){$(document).on("change","#aco-img-upload-box #aco-img-upload-input",function(){var c=$(this)[0].files;if(c.length>0){h.status="Preparing upload...",h.percentage="please wait",a.$apply(),$("#aco-img-upload-box").css({display:"table",opacity:"1"});var d=$(this).val().split(".").pop();console.log(d),"jpg"==d&&(d="jpeg"),"jpeg"==d||"png"==d||"gif"==d||"bmp"==d?f(c[0],g,"image/"+d):b.push("error","Invalid file","We are sorry, but this file-type is not supported.")}})}function f(a,b,c){var d=new Image,e=new FileReader;e.onload=function(a){d.src=a.target.result},e.readAsDataURL(a),d.onload=function(){var a,e=document.createElement("canvas"),f=e.getContext("2d");e.height=d.height,e.width=d.width,f.drawImage(d,0,0),a=e.toDataURL(c),b(a),e=null}}function g(c){h.status="Uploading image...",a.$apply();var e=acolyte.pathToServer+"content/file/edit/"+h.tmpImage.category+"/"+h.tmpImage.element,f=JSON.stringify({file:c});console.log(f),$.ajax({url:e,data:f,type:"PUT",contentType:"application/json",xhr:function(){var b=new window.XMLHttpRequest;return b.upload.addEventListener("progress",function(b){if(b.lengthComputable){var c=b.loaded/b.total;$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:100*c+"%"}),h.percentage=Math.round(100*c)+"%",a.$apply()}},!1),b.addEventListener("progress",function(b){if(b.lengthComputable){var c=b.loaded/b.total;$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:100*c+"%"}),h.percentage=Math.round(100*c)+"%",a.$apply()}},!1),b},success:function(c,e,f){console.log(c),200==f.status?($("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:"0%"}),$("#aco-img-upload-box").animate({opacity:"0"},400,function(){$("#aco-img-upload-box").css({display:"none"})}),d.setImage(h.tmpImage.category,h.tmpImage.element,c.fileContent.url),b.push("success","Image uploaded","Image has been successfully uploaded.")):b.push("error","Unknown error","Sorry, an unknown error occured while processing your request!"),a.$apply()},error:function(c,d,e){console.log(c),$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:"0%"}),$("#aco-img-upload-box").animate({opacity:"0"},400,function(){$("#aco-img-upload-box").css({display:"none"})}),b.push("error","Unknown error","Sorry, an unknown error occured while processing your request!"),a.$apply()}})}var h=this;h.status="Preparing upload...",h.percentage="please wait",h.tmpImage={},e(),a.$on("AcoNewUploadImage",function(){h.tmpImage=c.getTmpImage()})}])}(),function(){angular.module("Acolyte").directive("acoImg",function(){return{restrict:"AC",controller:"AcoImageController",controllerAs:"acoImgCtrl",replace:!0,scope:{category:"@",element:"@"},templateUrl:acolyte.pathToAcolyte+"templates/aco-image.html"}}).directive("acoBackground",["$compile","AcoPageContentService",function(a,b){return{restrict:"EC",controller:"AcoBackgroundController",controllerAs:"acoImgCtrl",scope:{category:"@",element:"@"},link:function(c,d,e){var f=acolyte.tmpImage,g=d.css("background-size"),h=d.css("background-position"),i=d.css("background-attachment"),j=d.css("background-repeat"),k="background:url("+f+");";k+="background-size:"+g+";",k+="background-position:"+h+";",k+="background-attachment:"+i+";",k+="background-repeat:"+j+";",e.$set("style",k),c.$on("AcoPageContentChanged",function(){var f=e.category,g=e.element,h=b.getImage(f,g);h||(h=acolyte.tmpImage);var i=d.css("background-size"),j=d.css("background-position"),k=d.css("background-attachment"),l=d.css("background-repeat"),m="background:url("+h+");";m+="background-size:"+i+";",m+="background-position:"+j+";",m+="background-attachment:"+k+";",m+="background-repeat:"+l+";",e.$set("style",m),d.find("aco-update-img-btn").remove(),d.append(a('<aco-update-img-btn ng-show="acoImgCtrl.editable" ng-click="acoImgCtrl.edit()">edit</div>')(c))})}}}]).directive("acoImgUpload",function(){return{restrict:"E",controller:"AcoImageUploadController",controllerAs:"acoImgUploadCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-img-upload.html"}})}(),function(){angular.module("Acolyte").factory("AcoImageUploadService",["$rootScope",function(a){var b=this;return b.tmpImage={},b.setTmpImage=function(a){b.tmpImage=a,b.broadcastNewTmpImage()},b.getTmpImage=function(){return b.tmpImage},b.broadcastNewTmpImage=function(){a.$broadcast("AcoNewUploadImage")},b}])}(),function(){angular.module("Acolyte").factory("AcoLanguageService",["$rootScpe",function(a){var b=this;return b.lan="en",b.languages=[{lan:"en",language:"English"}],b.getLanguages=function(){return b.languages},b.setLanguages=function(a){b.languages=a,b.broadcastLanguagesChanged()},b.setSelectedLan=function(a){b.lan=a,b.broadcastLanguagesChanged()},b.broadcastLanguagesChanged=function(){a.$broadcast("AcoLoginStateChanged")},b}])}(),function(){angular.module("Acolyte").controller("AcoLoginButtonController",["$scope","AcoLoginService",function(a,b){var c=this;c.loggedIn=!1,c.openLoginPanel=function(){c.loggedIn?b.logout():$("aco-login-box").fadeIn()},a.$on("AcoLoginStateChanged",function(){c.loggedIn=b.getLoginState()})}]).controller("AcoLoginBoxController",["$scope","AcoLoginService",function(a,b){var c=this;c.loginData={},c.login=function(){b.login(c.loginData.username,c.loginData.password)},c.close=function(){$("aco-login-box").fadeOut()},a.$on("AcoLoginStateChanged",function(){$("aco-login-box").fadeOut()})}])}(),function(){angular.module("Acolyte").directive("acoLogin",[function(){return{controller:"AcoLoginButtonController",controllerAs:"acoLoginBtnCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-login-btn.html"}}]).directive("acoLoginBox",[function(){return{controller:"AcoLoginBoxController",controllerAs:"acoLoginBoxCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-login-box.html"}}])}(),function(){angular.module("Acolyte").factory("AcoLoginService",["$rootScope","$http","AcoNotificationService",function(a,b,c){var d={};return d.loggedIn=!1,d.getLoginState=function(){return d.loggedIn},d.checkLoginState=function(){CreateRequest(function(a){b.get(acolyte.pathToServer+"user/view").success(function(a){console.log(a),null!=a.user&&(d.loggedIn=!0),d.broadcastLoginStatus()}).error(function(a){console.log(a),d.broadcastLoginStatus()})})},d.login=function(a,e){CreateRequest(function(f){var g={username:a,password:e,token:f};b.post(acolyte.pathToServer+"user/login",g).success(function(a){console.log(a),d.loggedIn=!0,c.push("success","Logged in","You where successfully logged in."),d.broadcastLoginStatus()}).error(function(a){console.log(a)})})},d.logout=function(){d.loggedIn=!1,c.push("success","Logged out","You where successfully logged out."),d.broadcastLoginStatus()},d.broadcastLoginStatus=function(){a.$broadcast("AcoLoginStateChanged")},d}])}(),function(){angular.module("Acolyte").controller("AcoNotificationController",["$scope","$timeout","AcoNotificationService",function(a,b,c){var d=this;d.notification={},d.timer=null,a.$on("AcoPushNotification",function(){null!=d.timer&&b.cancel(d.timer),$("aco-notification-box").hide("slide",200,function(){d.notification=c.getNotification(),$("aco-notification-box").show("slide",200,function(){d.timer=b(function(){$("aco-notification-box").hide("slide",200)},5e3)})})})}])}(),function(){angular.module("Acolyte").directive("acoNotificationBox",function(){return{restrict:"E",controller:"AcoNotificationController",controllerAs:"acoNotifyCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-notification-box.html"}})}(),function(){angular.module("Acolyte").factory("AcoNotificationService",["$rootScope",function(a){var b=this;return b.notification={type:"",title:"",message:""},b.push=function(a,c,d){b.notification.type=a,b.notification.title=c,b.notification.message=d,b.broadcastNotification()},b.getNotification=function(){return b.notification},b.broadcastNotification=function(){a.$broadcast("AcoPushNotification")},b}])}(),function(){angular.module("Acolyte").controller("AcoTextController",["$sce","$scope","$interval","$http","AcoPageContentService","AcoLoginService",function(a,b,c,d,e,f){function g(){f.getLoginState()&&CreateRequest(function(a){var c=acolyte.pathToServer+"content/text/edit/"+b.category+"/"+b.element,f={text:h.text,token:a};d.put(c,f).success(function(a){e.setText(b.category,b.element,a.textContent.text)}).error(function(a){console.log(a)})})}var h=this;h.editable=!1,h.timer=null,h.text=acolyte.tmpText,h.edit=function(a){f.getLoginState()&&h.editable&&(a.preventDefault(),a.stopPropagation(),c.cancel(h.timer),h.timer=c(function(){g()},acolyte.updateRate))},h.update=function(){f.getLoginState()&&(c.cancel(h.timer),h.timer=null,g())},b.$on("AcoPageContentChanged",function(){var a=e.getText(b.category,b.element);null==h.timer&&(a||(a=acolyte.newText),h.text=a)}),b.$on("AcoEditModeChanged",function(){h.editable=e.getEditMode()})}])}(),function(){angular.module("Acolyte").directive("acoText",function(){return{controller:"AcoTextController",controllerAs:"acoTxtCtrl",scope:{category:"@",element:"@"},templateUrl:acolyte.pathToAcolyte+"templates/aco-text.html"}}).directive("acoTextContenteditable",["$sce",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){function f(){var a=c.html();d.stripBr&&"<br>"==a&&(a=""),e.$setViewValue(a)}e&&(e.$render=function(){c.html(a.trustAsHtml(e.$viewValue)),c.html(e.$viewValue)},c.on("blur keyup change",function(){b.$evalAsync(f)}))}}}])}();