/**

	5-designs - company
	Acolyte
	created with love in Austria

	Version: 0.1.0
	Last changed: 24-11-2015
	Website: http://www.acolyte.5-designs.com
	Github: https://github.com/5-designs/acolyte

*/

function CreateRequest(a){for(var b=10,c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOP1234567890",d="",e=0;b>e;e++){var f=Math.floor(Math.random()*c.length);d+=c.charAt(f)}document.cookie="aco-key="+d+";path=/",a(d)}var acolyte={pathToAcolyte:"acolyte/",pathToServer:"acolyte/server/",tmpImage:"src/images/black.png",tmpText:"...",newText:"Hi, I'm a new text.",updateRate:1e3};!function(){angular.module("Acolyte",["ngSanitize"]).directive("acoRoot",function(){return{restrict:"E",controller:"AcoRootController",controllerAs:"rootCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-root.html"}}).factory("AcoPageContentService",["$rootScope","$http",function(a,b){var c={};return c.texts={},c.images={},c.edit=!1,c.setEdit=function(a){a?c.edit=a:c.edit=!c.edit,c.broadcastEditMode()},c.getEditMode=function(){return c.edit},c.fetchContent=function(){CreateRequest(function(a){b.get(acolyte.pathToServer+"content/get").success(function(a){console.log(a),c.texts=a.textContent;var b={fileContent:[{category:"home",element:"banner",src:"src/images/image2.jpg"},{category:"home",element:"image1",src:"src/images/eys2.jpg"},{category:"home",element:"image2",src:"src/images/image3.jpg"}]};c.images=b.fileContent,c.broadcastPageContent()}).error(function(a){console.log(a)})})},c.getText=function(a,b){for(var d=!1,e=0;e<c.texts.length;e++){var f=c.texts[e];f.category==a&&f.element==b&&(d=f.text)}return d},c.setText=function(a,b,d){for(var e=0;e<c.texts.length;e++){var f=c.texts[e];f.category==a&&f.element==b&&(c.texts[e].text=d)}c.broadcastPageContent()},c.getImage=function(a,b){for(var d=!1,e=0;e<c.images.length;e++){var f=c.images[e];f.category==a&&f.element==b&&(d=f.src)}return d},c.broadcastPageContent=function(){a.$broadcast("AcoPageContentChanged")},c.broadcastEditMode=function(){a.$broadcast("AcoEditModeChanged")},c}]).controller("AcoRootController",["$scope","$http","$timeout","AcoPageContentService","AcoLoginService",function(a,b,c,d,e){function f(){c(function(){d.fetchContent()})}f(),a.$on("AcoLoginStateChanged",function(){d.fetchContent()})}])}(),$(document).ready(function(){$("#clickEvent").click(function(){alert("this is a jQuery click event")})}),function(){angular.module("Acolyte").controller("AcoAdminController",["$scope","AcoPageContentService","AcoLoginService",function(a,b,c){function d(){$("aco-admin").draggable({handle:"#aco-admin-drag",containment:"document"})}var e=this;e.edit=!1,e.showPanel=!1,e.dragImg=acolyte.pathToAcolyte+"src/dragW.png",d(),e.setEditMode=function(){b.setEdit()},a.$on("AcoEditModeChanged",function(){e.edit=b.getEditMode()}),a.$on("AcoLoginStateChanged",function(){e.showPanel=c.getLoginState(),e.showPanel||b.setEdit(!1)})}])}(),function(){angular.module("Acolyte").directive("acoAdmin",function(){return{restrict:"E",controller:"AcoAdminController",controllerAs:"acoAdminCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-admin.html"}})}(),function(){angular.module("Acolyte").controller("AcoImageController",["$scope","$timeout","AcoPageContentService","AcoLoginService",function(a,b,c,d){var e=this;e.editable=!1,e.src=acolyte.tmpImage,e.edit=function(a){d.getLoginState()&&e.editable&&(a.preventDefault(),a.stopPropagation(),$("#aco-img-upload-box").find("#aco-img-upload-input").trigger("click"))},a.$on("AcoPageContentChanged",function(){var b=c.getImage(a.category,a.element);b||(b=acolyte.tmpImage),e.src=b}),a.$on("AcoEditModeChanged",function(){e.editable=c.getEditMode()})}]).controller("AcoBackgroundController",["$scope","AcoPageContentService","AcoLoginService",function(a,b,c){var d=this;d.editable=!1,d.edit=function(a){c.getLoginState()&&$("#aco-img-upload-box").find("#aco-img-upload-input").trigger("click")},a.$on("AcoEditModeChanged",function(){d.editable=b.getEditMode()}),a.$on("AcoLoginStateChanged",function(){c.getLoginState()||(d.editable=!1)})}]).controller("AcoImageUploadController",["$scope",function(a){function b(){$(document).on("change","#aco-img-upload-box #aco-img-upload-input",function(){var b=$(this)[0].files;b.length>0&&(e.status="Preparing upload...",e.percentage="please wait",a.$apply(),$("#aco-img-upload-box").css({display:"table"}),c(b[0],d,"image/png"))})}function c(a,b,c){var d=new Image,e=new FileReader;e.onload=function(a){d.src=a.target.result},e.readAsDataURL(a),d.onload=function(){var a,e=document.createElement("canvas"),f=e.getContext("2d");e.height=d.height,e.width=d.width,f.drawImage(d,0,0),a=e.toDataURL(c),b(a),e=null}}function d(b){e.status="Uploading image...",e.percentage="60%",a.$apply()}var e=this;e.status="Preparing upload...",e.percentage="please wait",b()}])}(),function(){angular.module("Acolyte").directive("acoImg",function(){return{restrict:"AC",controller:"AcoImageController",controllerAs:"acoImgCtrl",replace:!0,scope:{category:"@",element:"@"},templateUrl:acolyte.pathToAcolyte+"templates/aco-image.html"}}).directive("acoBackground",["$compile","AcoPageContentService",function(a,b){return{restrict:"EC",controller:"AcoBackgroundController",controllerAs:"acoImgCtrl",scope:{category:"@",element:"@"},link:function(c,d,e){var f=acolyte.tmpImage,g=d.css("background-size"),h=d.css("background-position"),i=d.css("background-attachment"),j=d.css("background-repeat"),k="background:url("+f+");";k+="background-size:"+g+";",k+="background-position:"+h+";",k+="background-attachment:"+i+";",k+="background-repeat:"+j+";",e.$set("style",k),c.$on("AcoPageContentChanged",function(){var f=e.category,g=e.element,h=b.getImage(f,g),i=d.css("background-size"),j=d.css("background-position"),k=d.css("background-attachment"),l=d.css("background-repeat"),m="background:url("+h+");";m+="background-size:"+i+";",m+="background-position:"+j+";",m+="background-attachment:"+k+";",m+="background-repeat:"+l+";",e.$set("style",m),d.find("aco-update-img-btn").remove(),d.append(a('<aco-update-img-btn ng-show="acoImgCtrl.editable" ng-click="acoImgCtrl.edit()">edit</div>')(c))})}}}]).directive("acoImgUpload",function(){return{restrict:"E",controller:"AcoImageUploadController",controllerAs:"acoImgUploadCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-img-upload.html"}})}(),function(){angular.module("Acolyte").controller("AcoLoginButtonController",["$scope","AcoLoginService",function(a,b){var c=this;c.loggedIn=!1,c.openLoginPanel=function(){c.loggedIn?b.logout():$("aco-login-box").fadeIn()},a.$on("AcoLoginStateChanged",function(){c.loggedIn=b.getLoginState()})}]).controller("AcoLoginBoxController",["$scope","AcoLoginService",function(a,b){var c=this;c.loginData={},c.login=function(){b.login(c.loginData.username,c.loginData.password)},c.close=function(){$("aco-login-box").fadeOut()},a.$on("AcoLoginStateChanged",function(){$("aco-login-box").fadeOut()})}])}(),function(){angular.module("Acolyte").directive("acoLogin",[function(){return{controller:"AcoLoginButtonController",controllerAs:"acoLoginBtnCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-login-btn.html"}}]).directive("acoLoginBox",[function(){return{controller:"AcoLoginBoxController",controllerAs:"acoLoginBoxCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-login-box.html"}}])}(),function(){angular.module("Acolyte").factory("AcoLoginService",["$rootScope",function(a){var b={};return b.loggedIn=!1,b.getLoginState=function(){return b.loggedIn},b.login=function(a,c){b.loggedIn=!0,b.broadcastLoginStatus()},b.logout=function(){b.loggedIn=!1,b.broadcastLoginStatus()},b.broadcastLoginStatus=function(){a.$broadcast("AcoLoginStateChanged")},b}])}(),function(){angular.module("Acolyte").controller("AcoTextController",["$sce","$scope","$interval","$http","AcoPageContentService","AcoLoginService",function(a,b,c,d,e,f){function g(){f.getLoginState()&&CreateRequest(function(a){var c=acolyte.pathToServer+"content/text/set/modified/"+b.category+"/"+b.element,f={text:h.text,token:a};d.put(c,f).success(function(a){e.setText(b.category,b.element,a.textContent.text)}).error(function(a){console.log(a)})})}var h=this;h.editable=!1,h.timer=null,h.text=acolyte.tmpText,h.edit=function(a){f.getLoginState()&&h.editable&&(a.preventDefault(),a.stopPropagation(),c.cancel(h.timer),h.timer=c(function(){g()},acolyte.updateRate))},h.update=function(){f.getLoginState()&&(c.cancel(h.timer),h.timer=null,g())},b.$on("AcoPageContentChanged",function(){var a=e.getText(b.category,b.element);null==h.timer&&(a||(a=acolyte.newText),h.text=a)}),b.$on("AcoEditModeChanged",function(){h.editable=e.getEditMode()})}])}(),function(){angular.module("Acolyte").directive("acoText",function(){return{controller:"AcoTextController",controllerAs:"acoTxtCtrl",scope:{category:"@",element:"@"},templateUrl:acolyte.pathToAcolyte+"templates/aco-text.html"}}).directive("acoTextContenteditable",["$sce",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){function f(){var a=c.html();d.stripBr&&"<br>"==a&&(a=""),e.$setViewValue(a)}e&&(e.$render=function(){c.html(a.trustAsHtml(e.$viewValue)),c.html(e.$viewValue)},c.on("blur keyup change",function(){b.$evalAsync(f)}))}}}])}();