/**

	5-designs - company
	Acolyte
	created with love in Austria

	Version: 0.1.0
	Last changed: 13-04-2016
	Website: http://www.acolyte.5-designs.com
	Github: https://github.com/5-designs/acolyte

*/

function CreateRequest(a){for(var b=10,c="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOP1234567890",d="",e=0;b>e;e++){var f=Math.floor(Math.random()*c.length);d+=c.charAt(f)}document.cookie="aco-token="+d+";path=/",a(d)}var acolyte={pathToAcolyte:"acolyte/",pathToServer:"acolyte/server/",tmpImage:"acolyte/src/black.png",tmpText:"...",newText:"New Acolyte Text",updateRate:1e3};!function(){angular.module("Acolyte",["ngSanitize"]).directive("acoRoot",function(){return{restrict:"E",controller:"AcoRootController",controllerAs:"rootCtrl",templateUrl:acolyte.pathToAcolyte+"templates/aco-root.html"}}).factory("AcoPageContentService",["$rootScope","$http",function(a,b){function c(a){d.texts=a.textContent,d.images=a.fileContent,d.broadcastPageContent(),d.initialized||("undefined"!=typeof pageContentLoaded&&pageContentLoaded(),d.initialized=!0)}var d={};return d.texts={},d.images={},d.initialized=!1,d.edit=!1,d.setEdit=function(a){"undefined"!=typeof a?d.edit=a:d.edit=!d.edit,d.broadcastEditMode()},d.getEditMode=function(){return d.edit},d.fetchContent=function(){CreateRequest(function(a){b.get(acolyte.pathToServer+"content/get").success(function(a){c(a)}).error(function(a){console.log(a)})})},d.setContent=function(a){c(a)},d.getText=function(a,b){for(var c=!1,e=0;e<d.texts.length;e++){var f=d.texts[e];f.category==a&&f.element==b&&(c=f.text)}return c},d.setText=function(a,b,c){for(var e=!1,f=0;f<d.texts.length;f++){var g=d.texts[f];g.category==a&&g.element==b&&(d.texts[f].text=c,e=!0)}if(!e){var g={category:a,element:b,text:c};d.texts.push(g)}d.broadcastPageContent()},d.getImage=function(a,b){for(var c=!1,e=0;e<d.images.length;e++){var f=d.images[e];f.category==a&&f.element==b&&(c=f.url)}return c},d.setImage=function(a,b,c){for(var e=!1,f=0;f<d.images.length;f++){var g=d.images[f];g.category==a&&g.element==b&&(d.images[f].url=c,e=!0)}if(!e){var g={category:a,element:b,url:c};d.images.push(g)}d.broadcastPageContent()},d.broadcastPageContent=function(){a.$broadcast("AcoPageContentChanged")},d.broadcastEditMode=function(){a.$broadcast("AcoEditModeChanged")},d}]).controller("AcoRootController",["$scope","$http","$timeout","AcoPageContentService","AcoLoginService",function(a,b,c,d,e){function f(){c(function(){e.checkLoginState()})}f(),a.$on("AcoLoginStateChanged",function(){d.fetchContent()})}])}(),function(){angular.module("Acolyte").controller("AcoAdminController",["$scope","$http","AcoPageContentService","AcoLoginService","AcoMessageBoxService","AcoNotificationService",function(a,b,c,d,e,f){function g(){$("#acoAdminPanel").draggable({handle:"#acoAdminDragBtn",containment:"document",stop:function(){var a=$(this).offset().top,b=$(window).scrollTop(),c=screen.availHeight;b>a&&$(this).css({top:"0px"});var d=b+c;a>d&&$(this).css({bottom:"0px"})}})}function h(){CreateRequest(function(a){b.put(acolyte.pathToServer+"content/save/all",{token:a}).success(function(a){f.push("success","Page published","Yeah, your page content is now visible for everyone.")}).error(function(a){console.log(a),f.push(a.type,a.title,a.message)})})}var i=this;i.edit=!1,i.showPanel=!1,i.img={},i.img.drag=acolyte.pathToAcolyte+"src/dragDots.svg",i.img.edit=acolyte.pathToAcolyte+"src/editW.svg",g(),i.setEditMode=function(){c.setEdit()},i.selectLan=function(){var a=$("#acoAdminPanel").find("#acoAdminLanBox"),b=$("#acoAdminPanel").find("#acoAdminTable");if("none"==a.css("display")){b.find("#acoAdminLanBtn").addClass("active");var c=a.outerHeight(),d=b.offset().top-$(window).scrollTop();c>d?(a.addClass("aco-lan-top"),a.removeClass("aco-lan-bottom")):(a.addClass("aco-lan-bottom"),a.removeClass("aco-lan-top"))}else b.find("#acoAdminLanBtn").removeClass("active");a.slideToggle(200)},i.publish=function(){e.pushMessage({title:"Publish your page",message:"Now, you can make your changes available for everyone. Are you sure that you want to publish your page?",buttons:[{title:"Yes, Publish",callback:h}]})},a.$on("AcoEditModeChanged",function(){i.edit=c.getEditMode()}),a.$on("AcoLoginStateChanged",function(){i.showPanel=d.getLoginState(),i.showPanel||c.setEdit(!1)})}])}(),function(){angular.module("Acolyte").directive("acoAdmin",function(){return{restrict:"E",controller:"AcoAdminController",controllerAs:"acoAdminCtrl",templateUrl:acolyte.pathToAcolyte+"templates/admin-panel.html"}})}(),function(){angular.module("Acolyte").controller("AcoImageController",["$scope","AcoPageContentService","AcoLoginService","AcoImageUploadService",function(a,b,c,d){function e(){var c=b.getImage(a.category,a.element);c||(c=acolyte.tmpImage),f.src=c}var f=this;f.editable=!1,f.src=acolyte.tmpImage,e(),f.edit=function(b){c.getLoginState()&&f.editable&&(b.preventDefault(),b.stopPropagation(),$("#aco-img-upload-box").find("#aco-img-upload-input").trigger("click"),d.setTmpImage({category:a.category,element:a.element}))},a.$on("AcoPageContentChanged",function(){var c=b.getImage(a.category,a.element);c||(c=acolyte.tmpImage),f.src=c}),a.$on("AcoEditModeChanged",function(){f.editable=b.getEditMode()})}]).controller("AcoBackgroundController",["$scope","AcoPageContentService","AcoLoginService","AcoImageUploadService",function(a,b,c,d){var e=this;e.editable=!1,e.edit=function(b){c.getLoginState()&&($("#aco-img-upload-box").find("#aco-img-upload-input").trigger("click"),d.setTmpImage({category:a.category,element:a.element}))},a.$on("AcoEditModeChanged",function(){e.editable=b.getEditMode()}),a.$on("AcoLoginStateChanged",function(){c.getLoginState()||(e.editable=!1)})}]).controller("AcoImageUploadController",["$scope","AcoNotificationService","AcoImageUploadService","AcoPageContentService",function(a,b,c,d){function e(){$(document).on("change","#aco-img-upload-box #aco-img-upload-input",function(){var c=$(this)[0].files;if(c.length>0){g.status="Preparing upload...",g.percentage="please wait",a.$apply(),$("#aco-img-upload-box").css({display:"table",opacity:"1"});var d=$(this).val().split(".").pop();"JPG"===d&&(d="jpg");var e=["jpg","jpeg","png","gif","bmp","svg"];e.indexOf(d)>=0?f(c[0]):b.push("error","Invalid file","We are sorry, but this file-type is not supported.")}})}function f(c){CreateRequest(function(e){g.status="Uploading image...",a.$apply();var f=acolyte.pathToServer+"content/file/edit/"+g.tmpImage.category+"/"+g.tmpImage.element,h=new FormData;h.append("image",c),h.append("token",e),$.ajax({url:f,data:h,type:"POST",processData:!1,contentType:!1,mimeType:"multipart/form-data",xhr:function(){var b=new window.XMLHttpRequest;return b.upload.addEventListener("progress",function(b){if(b.lengthComputable){var c=b.loaded/b.total;$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:100*c+"%"}),g.percentage=Math.round(100*c)+"%",a.$apply()}},!1),b.addEventListener("progress",function(b){if(b.lengthComputable){var c=b.loaded/b.total;$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:100*c+"%"}),g.percentage=Math.round(100*c)+"%",a.$apply()}},!1),b},success:function(c){c=JSON.parse(c),console.log("success"),console.log(c),$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:"0%"}),$("#aco-img-upload-box").animate({opacity:"0"},400,function(){$("#aco-img-upload-box").css({display:"none"})}),d.setImage(g.tmpImage.category,g.tmpImage.element,c.fileContent.url),b.push("success","Image uploaded","Image has been successfully uploaded."),a.$apply()},error:function(c,d,e){c=JSON.parse(c),console.log("error"),console.log(c),$("#aco-img-upload-box").find("#aco-img-upload-progress").css({width:"0%"}),$("#aco-img-upload-box").animate({opacity:"0"},400,function(){$("#aco-img-upload-box").css({display:"none"})}),b.push("error","Unknown error","Sorry, an unknown error occured while processing your request!"),a.$apply()}})})}var g=this;g.status="Preparing upload...",g.percentage="please wait",g.tmpImage={},e(),a.$on("AcoNewUploadImage",function(){g.tmpImage=c.getTmpImage()})}])}(),function(){angular.module("Acolyte").directive("acoImg",function(){return{restrict:"AC",controller:"AcoImageController",controllerAs:"acoImgCtrl",replace:!0,scope:{category:"@",element:"@"},templateUrl:acolyte.pathToAcolyte+"templates/aco-image.html"}}).directive("acoBackground",["$compile","AcoPageContentService",function(a,b){return{restrict:"EC",controller:"AcoBackgroundController",controllerAs:"acoImgCtrl",scope:{category:"@",element:"@"},link:function(c,d,e){var f=b.getImage(c.category,c.element);f||(f=acolyte.tmpImage);var g=d.css("background-size"),h=d.css("background-position"),i=d.css("background-attachment"),j=d.css("background-repeat"),k="background:url("+f+");";k+="background-size:"+g+";",k+="background-position:"+h+";",k+="background-attachment:"+i+";",k+="background-repeat:"+j+";",e.$set("style",k),d.find("aco-update-img-btn").remove(),d.append(a('<aco-update-img-btn ng-show="acoImgCtrl.editable" ng-click="acoImgCtrl.edit()">edit</div>')(c)),c.$on("AcoPageContentChanged",function(){var f=e.category,g=e.element,h=b.getImage(f,g);h||(h=acolyte.tmpImage);var i=d.css("background-size"),j=d.css("background-position"),k=d.css("background-attachment"),l=d.css("background-repeat"),m="background:url("+h+");";m+="background-size:"+i+";",m+="background-position:"+j+";",m+="background-attachment:"+k+";",m+="background-repeat:"+l+";",e.$set("style",m),d.find("aco-update-img-btn").remove(),d.append(a('<aco-update-img-btn ng-show="acoImgCtrl.editable" ng-click="acoImgCtrl.edit()">edit</div>')(c))})}}}]).directive("acoImgUpload",function(){return{restrict:"E",controller:"AcoImageUploadController",controllerAs:"acoImgUploadCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/aco-img-upload.html"}})}(),function(){angular.module("Acolyte").factory("AcoImageUploadService",["$rootScope",function(a){var b=this;return b.tmpImage={},b.setTmpImage=function(a){b.tmpImage=a,b.broadcastNewTmpImage()},b.getTmpImage=function(){return b.tmpImage},b.broadcastNewTmpImage=function(){a.$broadcast("AcoNewUploadImage")},b}])}(),function(){angular.module("Acolyte").controller("AcoLanguageController",["$scope","$http","AcoLanguageService","AcoMessageBoxService","AcoNotificationService",function(a,b,c,d,e){function f(){CreateRequest(function(a){b.get(acolyte.pathToServer+"language/get").success(function(a){c.initLanguages(a.lan,a.language),c.initAvailLanguages(a.languages)}).error(function(a){console.log(a)})})}function g(a){c.deleteAndTexts(a)}function h(a){c.deleteLanguage(a)}var i=this;i.lan="en",i.languages=[],i.newLanKeyword="",i.searchResults=[],f(),i.setLan=function(a){c.setLan(a)},i.setToggle=function(a){1!=a.preset?(console.log(a),c.setToggle(a)):e.push("error","Can not be deactivated","Sorry, but this language is set as default language and can not be deactivated.")},i.deleteLanguage=function(a){1!=a.preset?d.pushMessage({title:"Delete Language",message:"Do you want to keep the texts in the database or delete them permanently?",buttons:[{title:"Delete texts",callback:function(){g(a)}},{title:"Keep texts",callback:function(){h(a)}}]}):e.push("error","Can not be deleted","Sorry, but this language is set as default language and can not be deleted.")},i.searchLan=function(){i.searchResults=c.searchAvailLans(i.newLanKeyword)},i.addLanguage=function(a){i.newLanKeyword="",i.searchResults=[],c.addLanguage(a)},a.$on("AcoLanguagesChanged",function(){i.lan=c.getLan(),i.languages=c.getLanguages()})}]).controller("AcolyteLanguageController",["$scope","AcoLanguageService",function(a,b){var c=this;c.active="en",c.languages=[{lan:"en",language:"English"}],c.select=function(a){b.setLan(a.lan)},a.$on("AcoLanguagesChanged",function(){c.active=b.getLan(),c.languages=[];var a=b.getLanguages();for(var d in a)1==a[d].toggle&&c.languages.push(a[d])})}])}(),function(){angular.module("Acolyte").factory("AcoLanguageService",["$rootScope","$http","AcoPageContentService","AcoNotificationService",function(a,b,c,d){function e(a,b){var d=0;for(var e in f.languages)f.languages[e].lan==a.lan&&f.languages.splice(d,1),d++;f.lan=b.lan,c.setContent(b)}var f=this;return f.lan="en",f.languages=[{lan:"en",language:"English",toggle:1}],f.availableLanguages=[],f.newLanguage=null,f.deletedLanguage=null,f.initLanguages=function(a,b){f.lan=a,f.languages=b,f.broadcastLanguagesChanged()},f.initAvailLanguages=function(a){f.availableLanguages=a},f.getLan=function(){return f.lan},f.setLan=function(a){CreateRequest(function(e){b.put(acolyte.pathToServer+"language/set/"+a,{token:e}).success(function(a){c.setContent(a),f.lan=a.lan,f.broadcastLanguagesChanged()}).error(function(a){console.log(a),d.push("error","An error occured","The language could not be saved. Please, try again later.")})})},f.setLanOnly=function(a){console.log(a),f.lan=a,f.broadcastLanguagesChanged()},f.getLanguages=function(){return f.languages},f.searchAvailLans=function(a){var b=[];if(""!=a&&null!=a&&a.length>1)for(var c in f.availableLanguages){var d=f.availableLanguages[c],e=d.language.toLowerCase();(d.lan==a.toLowerCase()||e.indexOf(a.toLowerCase())>=0)&&b.push(f.availableLanguages[c])}return b},f.setToggle=function(a){CreateRequest(function(c){var e=0;0==a.toggle&&(e=1);var g={toggle:e,token:c};b.put(acolyte.pathToServer+"language/set/toggle/"+a.lan,g).success(function(b){console.log(b);for(var c in f.languages)f.languages[c].lan==a.lan&&(f.languages[c].toggle=e);f.broadcastLanguagesChanged()}).error(function(a){console.log(a),d.push("error","An error occured","The language could not be activated. Please, try again later.")})})},f.deleteLanguage=function(a){CreateRequest(function(c){b["delete"](acolyte.pathToServer+"language/remove/lan/"+a.lan,{token:c}).success(function(b){e(a,b),f.broadcastLanguagesChanged(),f.broadcastLanguageDeleted()}).error(function(a){console.log(a),d.push("error","An error occured","The language could not be deleted. Please, try again later.")})})},f.deleteAndTexts=function(a){CreateRequest(function(c){b["delete"](acolyte.pathToServer+"language/remove/all/"+a.lan,{token:c}).success(function(b){f.deletedLanguage=a,e(a,b),f.broadcastLanguagesChanged(),f.broadcastLanguageDeleted()}).error(function(a){console.log(a),d.push("error","An error occured","The language could not be deleted. Please, try again later.")})})},f.addLanguage=function(a){CreateRequest(function(c){var e={lan:a.lan,language:a.language,token:c};b.post(acolyte.pathToServer+"language/add",e).success(function(b){f.languages=b.language,f.newLanguage=a,f.broadcastLanguagesChanged(),f.broadcastNewLanguageCreated()}).error(function(a){console.log(a),d.push("error","An error occured","The language could not be added. Please, try again later.")})})},f.getNewLanguage=function(){return f.newLanguage},f.getDeletedLanguage=function(){return f.deletedLanguage},f.broadcastLanguagesChanged=function(){a.$broadcast("AcoLanguagesChanged")},f.broadcastNewLanguageCreated=function(){a.$broadcast("AcoNewLanguageCreated")},f.broadcastLanguageDeleted=function(){a.$broadcast("AcoLanguageDeleted")},f}])}(),function(){angular.module("Acolyte").controller("AcoLoginButtonController",["$scope","AcoLoginService",function(a,b){var c=this;c.loggedIn=!1,c.openLoginPanel=function(){c.loggedIn?b.logout():$("#acoLoginPanel").stop().fadeIn(400)},a.$on("AcoLoginStateChanged",function(){c.loggedIn=b.getLoginState()})}]).controller("AcoLoginBoxController",["$scope","AcoLoginService",function(a,b){var c=this;c.loginData={},c.login=function(){b.login(c.loginData.username,c.loginData.password)},c.close=function(){$("#acoLoginPanel").stop().fadeOut(400)},a.$on("AcoLoginStateChanged",function(){$("#acoLoginPanel").stop().fadeOut(400),c.loginData={}})}])}(),function(){angular.module("Acolyte").directive("acoLogin",[function(){return{controller:"AcoLoginButtonController",controllerAs:"loginCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/login-button.html"}}]).directive("acoLoginBox",[function(){return{controller:"AcoLoginBoxController",controllerAs:"loginCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/login-panel.html",link:function(a,b,c){b.click(function(a){$(a.target).is("#acoLoginBox")||0!==$("#acoLoginBox").has(a.target).length||$("#acoLoginPanel").stop().fadeOut(400)})}}}])}(),function(){angular.module("Acolyte").factory("AcoLoginService",["$rootScope","$http","AcoNotificationService","AcoLanguageService",function(a,b,c,d){var e={};return e.loggedIn=!1,e.getLoginState=function(){return e.loggedIn},e.checkLoginState=function(){CreateRequest(function(a){b.get(acolyte.pathToServer+"user/view").success(function(a){null!=a.user&&(e.loggedIn=!0),e.broadcastLoginStatus()}).error(function(a){console.log(a),e.broadcastLoginStatus()})})},e.login=function(a,d){CreateRequest(function(f){var g={username:a,password:d,token:f};b.post(acolyte.pathToServer+"user/login",g).success(function(a){e.loggedIn=!0,c.push("success","Welcome to Acolyte CMS","Successfully logged in."),e.broadcastLoginStatus()}).error(function(a){c.push(a.type,a.title,a.message)})})},e.logout=function(){CreateRequest(function(a){b.put(acolyte.pathToServer+"user/logout",{token:a}).success(function(a){e.loggedIn=!1,d.setLanOnly(a.lan),c.push("success","Good Bye!","Successfully logged out."),e.broadcastLoginStatus()}).error(function(a){console.log(a),c.push(a.type,a.title,a.message)})})},e.broadcastLoginStatus=function(){a.$broadcast("AcoLoginStateChanged")},e}])}(),function(){angular.module("Acolyte").controller("AcoMessageBoxController",["$scope","AcoMessageBoxService",function(a,b){function c(){$("#acoMessageBox").hide("fade",300,function(){d.title="",d.message="",d.buttons=[]})}var d=this;d.title="",d.message="",d.buttons=[],d.doCallback=function(a){a(),c()},d.cancel=function(){c()},a.$on("AcoMessageBoxDataChanged",function(){var a=b.getMessageData();d.title=a.title,d.message=a.message,d.buttons=a.buttons,$("#acoMessageBox").fadeIn(300)})}])}(),function(){angular.module("Acolyte").directive("acoMessageBox",function(){return{restrict:"E",controller:"AcoMessageBoxController",controllerAs:"acoMBCtrl",scope:{},templateUrl:acolyte.pathToAcolyte+"templates/message-box.html"}})}(),function(){angular.module("Acolyte").factory("AcoMessageBoxService",["$rootScope",function(a){var b=this;return b.messageData={},b.getMessageData=function(){return b.messageData},b.pushMessage=function(a){b.messageData=a,b.broadcastMessageDataChanged()},b.broadcastMessageDataChanged=function(){a.$broadcast("AcoMessageBoxDataChanged")},b}])}(),function(){angular.module("Acolyte").controller("AcoNotificationController",["$scope","$timeout","AcoNotificationService",function(a,b,c){var d=this;d.notification={},d.timer=null,d.push=function(a){null!=d.timer&&b.cancel(d.timer),$("#acoNotificationPanel").hide("slide",200,function(){d.notification=a,$("#acoNotificationPanel").show("slide",200,function(){d.timer=b(function(){$("#acoNotificationPanel").hide("slide",200)},5e3)})})},a.$on("AcoPushNotification",function(){var a=c.getNotification();d.push(a)})}])}(),function(){angular.module("Acolyte").directive("acoNotificationBox",function(){return{restrict:"E",controller:"AcoNotificationController",controllerAs:"notifyCtrl",templateUrl:acolyte.pathToAcolyte+"templates/notification-panel.html"}})}(),function(){angular.module("Acolyte").factory("AcoNotificationService",["$rootScope",function(a){var b=this;return b.notification={type:"",title:"",message:""},b.push=function(a,c,d){b.notification.type=a,b.notification.title=c,b.notification.message=d,b.broadcastNotification()},b.getNotification=function(){return b.notification},b.broadcastNotification=function(){a.$broadcast("AcoPushNotification")},b}])}(),function(){angular.module("Acolyte").controller("AcoTextController",["$sce","$scope","$interval","$http","AcoPageContentService","AcoLoginService",function(a,b,c,d,e,f){function g(){var a=e.getText(b.category,b.element);null==i.timer&&(a||(a=acolyte.newText),i.text=a)}function h(){f.getLoginState()&&CreateRequest(function(a){var c=acolyte.pathToServer+"content/text/edit/"+b.category+"/"+b.element,f={text:i.text,token:a};d.put(c,f).success(function(a){e.setText(b.category,b.element,a.textContent.text)}).error(function(a){console.log(a)})})}var i=this;i.editable=!1,i.timer=null,i.text=acolyte.tmpText,g(),i.edit=function(a){f.getLoginState()&&i.editable&&(a.preventDefault(),a.stopPropagation(),c.cancel(i.timer),i.timer=c(function(){h()},acolyte.updateRate))},i.update=function(){f.getLoginState()&&(c.cancel(i.timer),i.timer=null,h())},b.$on("AcoPageContentChanged",function(){var a=e.getText(b.category,b.element);null==i.timer&&(a||(a=acolyte.newText),i.text=a)}),b.$on("AcoEditModeChanged",function(){i.editable=e.getEditMode()})}])}(),function(){angular.module("Acolyte").directive("acoText",function(){return{controller:"AcoTextController",controllerAs:"acoTxtCtrl",scope:{category:"@",element:"@"},templateUrl:acolyte.pathToAcolyte+"templates/aco-text.html"}}).directive("acoTextContenteditable",["$sce",function(a){return{restrict:"A",require:"?ngModel",link:function(b,c,d,e){function f(){var a=c.html();d.stripBr&&"<br>"==a&&(a=""),e.$setViewValue(a)}e&&(e.$render=function(){c.html(a.trustAsHtml(e.$viewValue)),c.html(e.$viewValue)},c.on("blur keyup change",function(){b.$evalAsync(f)}))}}}])}();